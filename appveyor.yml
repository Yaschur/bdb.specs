version: 1.{build}

os: Visual Studio 2015

branches:
  only:
  - develop

nuget:
  account_feed: true
  disable_publish_on_pr: true

install:
  - ps: |
      $joined = (GitVersion) -join "`n"
      $versionInfo = ($joined | ConvertFrom-Json).NuGetVersionV2
      $json = Get-Content -Raw -Path "Bdb.Specs\project.json" | ConvertFrom-Json
      $json.version = $versionInfo
      $json | ConvertTo-Json -depth 999 | Out-File "Bdb.Specs\project.json"
      Update-AppveyorBuild -Version $versionInfo

before_build:
  - cmd: dnvm update-self
  - cmd: dnvm upgrade
  - cmd: dnu restore

build_script:
  - cmd: dnu pack Bdb.Specs --configuration Release --out artifacts

test: off

artifacts:
  - path: artifacts\**\*.nupkg